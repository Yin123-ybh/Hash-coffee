# 优惠券管理功能说明

## 功能概述

本次为咖啡店项目新增了完整的优惠券管理、秒杀活动和优惠券统计功能，包括：

1. **优惠券模板管理** - 创建、编辑、删除优惠券模板
2. **优惠券发放** - 批量发放优惠券给指定用户或所有用户
3. **秒杀活动管理** - 创建、管理秒杀活动
4. **优惠券统计** - 统计优惠券使用情况和效果分析

## 数据库表结构

### 1. 优惠券模板表 (coupon_template)
- 存储优惠券的基本信息，如名称、类型、折扣值等
- 支持满减券、折扣券、代金券三种类型

### 2. 优惠券表 (coupon)
- 存储具体的优惠券实例
- 关联用户和模板，记录使用状态

### 3. 秒杀活动表 (seckill_activity)
- 存储秒杀活动信息
- 关联菜品，设置秒杀价格和库存

### 4. 订单优惠券关联表 (order_coupon)
- 记录订单使用的优惠券信息

## API接口

### 优惠券模板管理
- `GET /api/admin/coupon/template/page` - 分页查询优惠券模板
- `GET /api/admin/coupon/template/{id}` - 根据ID查询优惠券模板
- `POST /api/admin/coupon/template` - 新增优惠券模板
- `PUT /api/admin/coupon/template` - 修改优惠券模板
- `DELETE /api/admin/coupon/template/{id}` - 删除优惠券模板
- `PUT /api/admin/coupon/template/status/{id}/{status}` - 更新状态

### 优惠券管理
- `POST /api/admin/coupon/batch-issue` - 批量发放优惠券
- `GET /api/admin/coupon/user/{userId}` - 查询用户优惠券
- `PUT /api/admin/coupon/use/{couponId}` - 使用优惠券
- `GET /api/admin/coupon/check/{userId}/{templateId}` - 检查是否已领取

### 秒杀活动管理
- `GET /api/admin/seckill/activity/page` - 分页查询秒杀活动
- `GET /api/admin/seckill/activity/{id}` - 根据ID查询秒杀活动
- `POST /api/admin/seckill/activity` - 新增秒杀活动
- `PUT /api/admin/seckill/activity` - 修改秒杀活动
- `DELETE /api/admin/seckill/activity/{id}` - 删除秒杀活动
- `PUT /api/admin/seckill/activity/status/{id}/{status}` - 更新状态

### 统计功能
- `GET /api/admin/coupon/template/statistics` - 获取优惠券统计信息
- `GET /api/admin/seckill/statistics` - 获取秒杀活动统计信息

## 核心功能

### 1. 优惠券模板管理
- 支持三种优惠券类型：满减券、折扣券、代金券
- 可设置使用门槛、有效期、发放数量等
- 支持启用/禁用状态管理

### 2. 优惠券发放
- 支持指定用户发放和全用户发放
- 自动生成唯一优惠券码
- 检查用户领取限制

### 3. 秒杀活动
- 关联菜品设置秒杀价格
- 库存管理和销售统计
- 时间范围控制

### 4. 统计功能
- 优惠券使用统计
- 秒杀活动效果分析
- 支持时间范围查询

## 定时任务

系统包含定时任务 `CouponTask`，每分钟检查一次过期优惠券并自动更新状态。

## 前端集成

前端页面已包含相应的管理界面：
- 优惠券模板管理页面
- 秒杀活动管理页面
- 优惠券统计页面

所有API接口都按照前端页面的需求进行设计，确保前后端完美对接。

## 注意事项

1. 确保数据库已执行 `script-coffee.sql` 脚本
2. 确保nginx配置正确指向后端服务端口8084
3. 定时任务需要确保Spring Boot应用正常运行
4. 优惠券码生成使用UUID，确保唯一性

## 测试

可以运行 `CouponTest` 类进行基本功能测试，验证优惠券模板创建功能。
